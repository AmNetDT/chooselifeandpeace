(()=>{var e={};e.id=673,e.ids=[673],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},47261:e=>{"use strict";e.exports=require("node:util")},90193:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>c.a,__next_app__:()=>u,originalPathname:()=>f,pages:()=>l,routeModule:()=>b,tree:()=>o}),t(34347),t(60827),t(90996),t(13529);var a=t(30170),s=t(45002),d=t(83876),c=t.n(d),i=t(66299),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);t.d(r,n);let o=["",{children:["(root)",{children:["place-order",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,34347)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,60827)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,90996,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,13529)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,90996,23)),"next/dist/client/components/not-found-error"]}],l=["/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/page.tsx"],f="/(root)/place-order/page",u={require:t,loadChunk:()=>Promise.resolve()},b=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(root)/place-order/page",pathname:"/place-order",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},20109:(e,r,t)=>{let a={"41fc677b184effcb0016e001cd930a9fb30ddb0a":()=>Promise.resolve().then(t.bind(t,6001)).then(e=>e.addItemToCart),"9ca5872de79006ed19093a5fb9a9561bb840e13b":()=>Promise.resolve().then(t.bind(t,6001)).then(e=>e.$$ACTION_1),d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473:()=>Promise.resolve().then(t.bind(t,6001)).then(e=>e.$$ACTION_0),d33ae3afc17ff86a896b65bbc01c77b3fd04f032:()=>Promise.resolve().then(t.bind(t,6001)).then(e=>e.removeItemFromCart),fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c:()=>Promise.resolve().then(t.bind(t,6001)).then(e=>e.getMyCart),"37248d5a5d92203bea071298526bbf56bd6a282e":()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.updateProfile),"4896ea1b4f1dace1ade49eb3651161dc0c4f102a":()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.getUserById),"6f62a9caef1528e29ef4461e98a41e80f8b1eae5":()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.SignOut),"7ef6945e100c99ebbac8da6a81410b4410597f01":()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.updateUserAddress),"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4":()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.$$ACTION_0),abc73778e07b95e9d8f15868fea7f03dbbca9e71:()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.updateUserPaymentMethod),be840f0dc3afac8b8d0c6b02dc3328bacb294db1:()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.signUp),c90075d8792b89f7584984a67b421aab69e556af:()=>Promise.resolve().then(t.bind(t,23829)).then(e=>e.signInWithCredentials)};async function s(e,...r){return(await a[e]()).apply(null,r)}e.exports={"41fc677b184effcb0016e001cd930a9fb30ddb0a":s.bind(null,"41fc677b184effcb0016e001cd930a9fb30ddb0a"),"9ca5872de79006ed19093a5fb9a9561bb840e13b":s.bind(null,"9ca5872de79006ed19093a5fb9a9561bb840e13b"),d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473:s.bind(null,"d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473"),d33ae3afc17ff86a896b65bbc01c77b3fd04f032:s.bind(null,"d33ae3afc17ff86a896b65bbc01c77b3fd04f032"),fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c:s.bind(null,"fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c"),"37248d5a5d92203bea071298526bbf56bd6a282e":s.bind(null,"37248d5a5d92203bea071298526bbf56bd6a282e"),"4896ea1b4f1dace1ade49eb3651161dc0c4f102a":s.bind(null,"4896ea1b4f1dace1ade49eb3651161dc0c4f102a"),"6f62a9caef1528e29ef4461e98a41e80f8b1eae5":s.bind(null,"6f62a9caef1528e29ef4461e98a41e80f8b1eae5"),"7ef6945e100c99ebbac8da6a81410b4410597f01":s.bind(null,"7ef6945e100c99ebbac8da6a81410b4410597f01"),"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4":s.bind(null,"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4"),abc73778e07b95e9d8f15868fea7f03dbbca9e71:s.bind(null,"abc73778e07b95e9d8f15868fea7f03dbbca9e71"),be840f0dc3afac8b8d0c6b02dc3328bacb294db1:s.bind(null,"be840f0dc3afac8b8d0c6b02dc3328bacb294db1"),c90075d8792b89f7584984a67b421aab69e556af:s.bind(null,"c90075d8792b89f7584984a67b421aab69e556af")}},6906:(e,r,t)=>{let a={"413193ecb56048609af8628b5e95dee0ff5a93cf":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.updateOrderToPaid),"52c4508c960f2657f71a1fde5a781c8b1e116f52":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.approvePayPalOrder),"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.getOrderById),"62915f7c5455fffd80487d2ea4fe069934717803":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.$$ACTION_0),"8428591957a96fc1d06bdf1ae8a31cca2aed9436":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.$$ACTION_1),"8b7a29abd0e74ef74c46c98c97840b6db3b5145f":()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.getMyOrders),d20716accc4a0d8fc583e0f1745f62f4af5f6691:()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.createPayPalOrder),ea248243752e282f1c9161e3241b42d6adba1007:()=>Promise.resolve().then(t.bind(t,19680)).then(e=>e.createOrder)};async function s(e,...r){return(await a[e]()).apply(null,r)}e.exports={"413193ecb56048609af8628b5e95dee0ff5a93cf":s.bind(null,"413193ecb56048609af8628b5e95dee0ff5a93cf"),"52c4508c960f2657f71a1fde5a781c8b1e116f52":s.bind(null,"52c4508c960f2657f71a1fde5a781c8b1e116f52"),"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c":s.bind(null,"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c"),"62915f7c5455fffd80487d2ea4fe069934717803":s.bind(null,"62915f7c5455fffd80487d2ea4fe069934717803"),"8428591957a96fc1d06bdf1ae8a31cca2aed9436":s.bind(null,"8428591957a96fc1d06bdf1ae8a31cca2aed9436"),"8b7a29abd0e74ef74c46c98c97840b6db3b5145f":s.bind(null,"8b7a29abd0e74ef74c46c98c97840b6db3b5145f"),d20716accc4a0d8fc583e0f1745f62f4af5f6691:s.bind(null,"d20716accc4a0d8fc583e0f1745f62f4af5f6691"),ea248243752e282f1c9161e3241b42d6adba1007:s.bind(null,"ea248243752e282f1c9161e3241b42d6adba1007")}},67610:(e,r,t)=>{Promise.resolve().then(t.bind(t,88232)),Promise.resolve().then(t.t.bind(t,15889,23)),Promise.resolve().then(t.t.bind(t,34080,23))},95259:(e,r,t)=>{Promise.resolve().then(t.bind(t,21615)),Promise.resolve().then(t.bind(t,27387)),Promise.resolve().then(t.bind(t,6047)),Promise.resolve().then(t.bind(t,94049)),Promise.resolve().then(t.t.bind(t,15889,23)),Promise.resolve().then(t.t.bind(t,34080,23))},88232:(e,r,t)=>{"use strict";t.d(r,{default:()=>o});var a=t(97247),s=t(3387);let d=(0,t(26323).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var c=t(46817),i=t(58053),n=t(31886);function o(){let[e,r]=(0,c.useFormState)(n.LV,{success:!1,message:""});return(0,a.jsxs)("form",{action:r,className:"w-full",children:[a.jsx(()=>{let{pending:e}=(0,c.useFormStatus)();return(0,a.jsxs)(i.z,{disabled:e,className:"w-full",children:[e?a.jsx(s.Z,{className:"w-4 h-4 animate-spin"}):a.jsx(d,{className:"w-4 h-4"})," ","Place Order"]})},{}),!e.success&&a.jsx("p",{className:"text-destructive py-4",children:e.message})]})}},31886:(e,r,t)=>{"use strict";t.d(r,{LV:()=>s,Yx:()=>c,ZM:()=>d}),t(70689);var a=t(11294);(0,a.$)("413193ecb56048609af8628b5e95dee0ff5a93cf"),(0,a.$)("5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c"),(0,a.$)("8b7a29abd0e74ef74c46c98c97840b6db3b5145f");var s=(0,a.$)("ea248243752e282f1c9161e3241b42d6adba1007"),d=(0,a.$)("d20716accc4a0d8fc583e0f1745f62f4af5f6691"),c=(0,a.$)("52c4508c960f2657f71a1fde5a781c8b1e116f52")},26323:(e,r,t)=>{"use strict";t.d(r,{Z:()=>n});var a=t(28964);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),d=(...e)=>e.filter((e,r,t)=>!!e&&t.indexOf(e)===r).join(" ");var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:n,iconNode:o,...l},f)=>(0,a.createElement)("svg",{ref:f,...c,width:r,height:r,stroke:e,strokeWidth:s?24*Number(t)/Number(r):t,className:d("lucide",i),...l},[...o.map(([e,r])=>(0,a.createElement)(e,r)),...Array.isArray(n)?n:[n]])),n=(e,r)=>{let t=(0,a.forwardRef)(({className:t,...c},n)=>(0,a.createElement)(i,{ref:n,iconNode:r,className:d(`lucide-${s(e)}`,t),...c}));return t.displayName=`${e}`,t}},3387:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a});let a=(0,t(26323).Z)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},60827:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(72051),s=t(27231),d=t(11931);function c({children:e}){return(0,a.jsxs)("div",{className:"flex h-screen flex-col",children:[a.jsx(d.Z,{}),a.jsx("main",{className:"flex-1 wrapper",children:e}),a.jsx(s.Z,{})]})}t(26269)},34347:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>j,metadata:()=>w});var a=t(72051),s=t(59624),d=t(92349),c=t(41288),i=t(26269),n=t.n(i),o=t(1779),l=t(37170);let f=({current:e=0})=>a.jsx("div",{className:"flex-between  flex-col md:flex-row  space-x-2 space-y-2",children:["User Login","Shipping Address","Payment Method","Place Order"].map((r,t)=>(0,a.jsxs)(n().Fragment,{children:[a.jsx("div",{className:(0,l.cn)("p-2 w-56 rounded-full text-center  text-sm",t===e?"bg-secondary":""),children:r}),"Place Order"!==r&&a.jsx("hr",{className:"w-16 border-t border-gray-300 mx-2"})]},r))});var u=t(98300),b=t(6669),h=t(52621),p=t(6001),m=t(23829),x=t(89112);let y=(0,t(45347).createProxy)(String.raw`/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/place-order-form.tsx#default`),w={title:`Place Order - ${x.iC}`};async function j(){let e=await (0,p.getMyCart)(),r=await (0,o.I8)(),t=await (0,m.getUserById)(r?.user.id);return e&&0!==e.items.length||(0,c.redirect)("/cart"),t.address||(0,c.redirect)("/shipping-address"),t.paymentMethod||(0,c.redirect)("/payment-method"),(0,a.jsxs)(a.Fragment,{children:[a.jsx(f,{current:3}),a.jsx("h1",{className:"py-4 text-2xl",children:"Place Order"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 md:gap-5",children:[(0,a.jsxs)("div",{className:"overflow-x-auto md:col-span-2 space-y-4",children:[a.jsx(b.Zb,{children:(0,a.jsxs)(b.aY,{className:"p-4 gap-4",children:[a.jsx("h2",{className:"text-xl pb-4",children:"Shipping Address"}),a.jsx("p",{children:t.address.fullName}),(0,a.jsxs)("p",{children:[t.address.streetAddress,", ",t.address.city,","," ",t.address.postalCode,", ",t.address.country," "]}),a.jsx("div",{children:a.jsx(d.default,{href:"/shipping-address",children:a.jsx(u.z,{variant:"outline",children:"Edit"})})})]})}),a.jsx(b.Zb,{children:(0,a.jsxs)(b.aY,{className:"p-4 gap-4",children:[a.jsx("h2",{className:"text-xl pb-4",children:"Payment Method"}),a.jsx("p",{children:t.paymentMethod}),a.jsx("div",{children:a.jsx(d.default,{href:"/payment-method",children:a.jsx(u.z,{variant:"outline",children:"Edit"})})})]})}),a.jsx(b.Zb,{children:(0,a.jsxs)(b.aY,{className:"p-4 gap-4",children:[a.jsx("h2",{className:"text-xl pb-4",children:"Order Items"}),(0,a.jsxs)(h.iA,{children:[a.jsx(h.xD,{children:(0,a.jsxs)(h.SC,{children:[a.jsx(h.ss,{children:"Item"}),a.jsx(h.ss,{children:"Quantity"}),a.jsx(h.ss,{children:"Price"})]})}),a.jsx(h.RM,{children:e.items.map(e=>(0,a.jsxs)(h.SC,{children:[a.jsx(h.pj,{children:(0,a.jsxs)(d.default,{href:`/product/${e.slug}`,className:"flex items-center",children:[a.jsx(s.default,{src:e.image,alt:e.name,width:50,height:50}),a.jsx("span",{className:"px-2",children:e.name})]})}),a.jsx(h.pj,{children:a.jsx("span",{className:"px-2",children:e.qty})}),(0,a.jsxs)(h.pj,{className:"text-right",children:["$",e.price]})]},e.slug))})]}),a.jsx(d.default,{href:"/cart",children:a.jsx(u.z,{variant:"outline",children:"Edit"})})]})})]}),a.jsx("div",{children:a.jsx(b.Zb,{children:(0,a.jsxs)(b.aY,{className:"p-4 gap-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("div",{children:"Items"}),a.jsx("div",{children:(0,l.xG)(e.itemsPrice)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("div",{children:"Tax"}),a.jsx("div",{children:(0,l.xG)(e.taxPrice)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("div",{children:"Shipping"}),a.jsx("div",{children:(0,l.xG)(e.shippingPrice)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("div",{children:"Total"}),a.jsx("div",{children:(0,l.xG)(e.totalPrice)})]}),a.jsx(y,{})]})})})]})]})}},52621:(e,r,t)=>{"use strict";t.d(r,{RM:()=>n,SC:()=>o,iA:()=>c,pj:()=>f,ss:()=>l,xD:()=>i});var a=t(72051),s=t(26269),d=t(37170);let c=s.forwardRef(({className:e,...r},t)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:t,className:(0,d.cn)("w-full caption-bottom text-sm",e),...r})}));c.displayName="Table";let i=s.forwardRef(({className:e,...r},t)=>a.jsx("thead",{ref:t,className:(0,d.cn)("[&_tr]:border-b",e),...r}));i.displayName="TableHeader";let n=s.forwardRef(({className:e,...r},t)=>a.jsx("tbody",{ref:t,className:(0,d.cn)("[&_tr:last-child]:border-0",e),...r}));n.displayName="TableBody",s.forwardRef(({className:e,...r},t)=>a.jsx("tfoot",{ref:t,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let o=s.forwardRef(({className:e,...r},t)=>a.jsx("tr",{ref:t,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));o.displayName="TableRow";let l=s.forwardRef(({className:e,...r},t)=>a.jsx("th",{ref:t,className:(0,d.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r}));l.displayName="TableHead";let f=s.forwardRef(({className:e,...r},t)=>a.jsx("td",{ref:t,className:(0,d.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r}));f.displayName="TableCell",s.forwardRef(({className:e,...r},t)=>a.jsx("caption",{ref:t,className:(0,d.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption"},19680:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$ACTION_0:()=>Z,$$ACTION_1:()=>T,approvePayPalOrder:()=>A,createOrder:()=>_,createPayPalOrder:()=>E,getMyOrders:()=>O,getOrderById:()=>C,updateOrderToPaid:()=>M});var a=t(28713);t(9640);var s=t(6352),d=t(79306),c=t(39558),i=t(54068),n=t(53020),o=t(62276),l=t(70592),f=t(80166),u=t(83557);async function b(){let e=n.cookies().get("sessionCartId")?.value;if(!e)return;let r=await (0,s.I8)(),t=r?.user.id;return await d.Z.query.carts.findFirst({where:t?(0,i.eq)(c.carts.userId,t):(0,i.eq)(c.carts.sessionCartId,e)})}let h=e=>{let r=(0,l.Xp)(e.reduce((e,r)=>e+r.price*r.qty,0)),t=(0,l.Xp)(r>100?0:10),a=(0,l.Xp)(.15*r),s=(0,l.Xp)(r+t+a);return{itemsPrice:r.toFixed(2),shippingPrice:t.toFixed(2),taxPrice:a.toFixed(2),totalPrice:s.toFixed(2)}},p=(0,a.j)("d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473",m);async function m(e){try{let r=n.cookies().get("sessionCartId")?.value;if(!r)throw Error("Cart Session not found");let t=await (0,s.I8)(),a=t?.user.id,l=await b(),u=o.oU.parse(e),p=await d.Z.query.products.findFirst({where:(0,i.eq)(c.products.id,u.productId)});if(!p)throw Error("Product not found");if(l){let e=l.items.find(e=>e.productId===u.productId);if(e){if(p.stock<e.qty+1)throw Error("Not enough stock");l.items.find(e=>e.productId===u.productId).qty=e.qty+1}else{if(p.stock<1)throw Error("Not enough stock");l.items.push(u)}return await d.Z.update(c.carts).set({items:l.items,...h(l.items)}).where((0,i.xD)((0,i.eq)(c.carts.id,l.id))),(0,f.revalidatePath)(`/product/${p.slug}`),{success:!0,message:`${p.name} ${e?"updated in":"added to"} cart successfully`}}if(p.stock<1)throw Error("Not enough stock");return await d.Z.insert(c.carts).values({userId:a,items:[u],sessionCartId:r,...h([u])}),(0,f.revalidatePath)(`/product/${p.slug}`),{success:!0,message:"Item added to cart successfully"}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}let x=(0,a.j)("9ca5872de79006ed19093a5fb9a9561bb840e13b",y);async function y(e){try{if(!n.cookies().get("sessionCartId")?.value)throw Error("Cart Session not found");let r=await d.Z.query.products.findFirst({where:(0,i.eq)(c.products.id,e)});if(!r)throw Error("Product not found");let t=await b();if(!t)throw Error("Cart not found");let a=t.items.find(r=>r.productId===e);if(!a)throw Error("Item not found");return 1===a.qty?t.items=t.items.filter(e=>e.productId!==a.productId):t.items.find(r=>r.productId===e).qty=a.qty-1,await d.Z.update(c.carts).set({items:t.items,...h(t.items)}).where((0,i.eq)(c.carts.id,t.id)),(0,f.revalidatePath)(`/product/${r.slug}`),{success:!0,message:`${r.name}  ${t.items.find(r=>r.productId===e)?"updated in":"removed from"} cart successfully`}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}(0,u.h)([b,p,x]),(0,a.j)("fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c",b),(0,a.j)("41fc677b184effcb0016e001cd930a9fb30ddb0a",p),(0,a.j)("d33ae3afc17ff86a896b65bbc01c77b3fd04f032",x);var w=t(48185),j=t(19188),v=t(47502),P=t(87729),g=t(22614);let N=process.env.PAYPAL_API_URL||"https://api-m.sandbox.paypal.com",q={createOrder:async function(e){let r=await I(),t=`${N}/v2/checkout/orders`;return $(await fetch(t,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:e}}]})}))},capturePayment:async function(e){let r=await I(),t=`${N}/v2/checkout/orders/${e}/capture`;return $(await fetch(t,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}))}};async function I(){let{PAYPAL_CLIENT_ID:e,PAYPAL_APP_SECRET:r}=process.env,t=Buffer.from(e+":"+r).toString("base64"),a=await fetch(`${N}/v1/oauth2/token`,{method:"post",body:"grant_type=client_credentials",headers:{Authorization:`Basic ${t}`}});return(await $(a)).access_token}async function $(e){if(200===e.status||201===e.status)return e.json();throw Error(await e.text())}var k=t(6335);async function C(e){return await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e),with:{orderItems:!0,user:{columns:{name:!0,email:!0}}}})}async function O({limit:e=k.IV,page:r}){let t=await (0,s.I8)();if(!t)throw Error("User is not authenticated");return{data:await d.Z.query.orders.findMany({where:(0,i.eq)(c.orders.userId,t.user.id),orderBy:[(0,v.C)(c.products.createdAt)],limit:e,offset:(r-1)*e}),totalPages:Math.ceil((await d.Z.select({count:(0,P.i6)`count(${P.i6.raw("*")})`.mapWith(Number)}).from(c.orders).where((0,i.eq)(c.orders.userId,t.user.id)))[0].count/e)}}let _=(0,a.j)("62915f7c5455fffd80487d2ea4fe069934717803",Z);async function Z(){try{let e=await (0,s.I8)();if(!e)throw Error("User is not authenticated");let r=await b(),t=await (0,w.getUserById)(e?.user.id);r&&0!==r.items.length||(0,j.redirect)("/cart"),t.address||(0,j.redirect)("/shipping-address"),t.paymentMethod||(0,j.redirect)("/payment-method");let a=o.Mn.parse({userId:t.id,shippingAddress:t.address,paymentMethod:t.paymentMethod,itemsPrice:r.itemsPrice,shippingPrice:r.shippingPrice,taxPrice:r.taxPrice,totalPrice:r.totalPrice}),n=await d.Z.transaction(async e=>{let t=await e.insert(c.orders).values(a).returning();for(let a of r.items)await e.insert(c.orderItems).values({...a,price:a.price.toFixed(2),orderId:t[0].id});return await d.Z.update(c.carts).set({items:[],totalPrice:"0",shippingPrice:"0",taxPrice:"0",itemsPrice:"0"}).where((0,i.eq)(c.carts.id,r.id)),t[0].id});if(!n)throw Error("Order not created");(0,j.redirect)(`/order/${n}`)}catch(e){if((0,g.isRedirectError)(e))throw e;return{success:!1,message:(0,l.Z)(e)}}}async function E(e){try{let r=await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e)});if(r){let t=await q.createOrder(Number(r.totalPrice));return await d.Z.update(c.orders).set({paymentResult:{id:t.id,email_address:"",status:"",pricePaid:"0"}}).where((0,i.eq)(c.orders.id,e)),{success:!0,message:"PayPal order created successfully",data:t.id}}throw Error("Order not found")}catch(e){return{success:!1,message:(0,l.Z)(e)}}}async function A(e,r){try{let t=await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e)});if(!t)throw Error("Order not found");let a=await q.capturePayment(r.orderID);if(!a||a.id!==t.paymentResult?.id||"COMPLETED"!==a.status)throw Error("Error in paypal payment");return await M({orderId:e,paymentResult:{id:a.id,status:a.status,email_address:a.payer.email_address,pricePaid:a.purchase_units[0]?.payments?.captures[0]?.amount?.value}}),(0,f.revalidatePath)(`/order/${e}`),{success:!0,message:"Your order has been successfully paid by PayPal"}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}let M=(0,a.j)("8428591957a96fc1d06bdf1ae8a31cca2aed9436",T);async function T({orderId:e,paymentResult:r}){let t=await d.Z.query.orders.findFirst({columns:{isPaid:!0},where:(0,i.eq)(c.orders.id,e),with:{orderItems:!0}});if(!t)throw Error("Order not found");if(t.isPaid)throw Error("Order is already paid");await d.Z.transaction(async a=>{for(let e of t.orderItems)await a.update(c.products).set({stock:(0,P.i6)`${c.products.stock} - ${e.qty}`}).where((0,i.eq)(c.products.id,e.productId));await a.update(c.orders).set({isPaid:!0,paidAt:new Date,paymentResult:r}).where((0,i.eq)(c.orders.id,e))})}(0,u.h)([C,O,_,E,A,M]),(0,a.j)("5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c",C),(0,a.j)("8b7a29abd0e74ef74c46c98c97840b6db3b5145f",O),(0,a.j)("ea248243752e282f1c9161e3241b42d6adba1007",_),(0,a.j)("d20716accc4a0d8fc583e0f1745f62f4af5f6691",E),(0,a.j)("52c4508c960f2657f71a1fde5a781c8b1e116f52",A),(0,a.j)("413193ecb56048609af8628b5e95dee0ff5a93cf",M)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[329,390,417,27,771,438,453,756,994,798,24],()=>t(90193));module.exports=a})();