(()=>{var e={};e.id=673,e.ids=[673],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},47261:e=>{"use strict";e.exports=require("node:util")},90193:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>c.a,__next_app__:()=>u,originalPathname:()=>f,pages:()=>l,routeModule:()=>b,tree:()=>o}),a(34347),a(60827),a(90996),a(97598);var t=a(30170),s=a(45002),d=a(83876),c=a.n(d),i=a(66299),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);a.d(r,n);let o=["",{children:["(root)",{children:["place-order",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,34347)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,60827)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,97598)),"/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,90996,23)),"next/dist/client/components/not-found-error"]}],l=["/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/page.tsx"],f="/(root)/place-order/page",u={require:a,loadChunk:()=>Promise.resolve()},b=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(root)/place-order/page",pathname:"/place-order",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},20109:(e,r,a)=>{let t={"41fc677b184effcb0016e001cd930a9fb30ddb0a":()=>Promise.resolve().then(a.bind(a,6001)).then(e=>e.addItemToCart),"9ca5872de79006ed19093a5fb9a9561bb840e13b":()=>Promise.resolve().then(a.bind(a,6001)).then(e=>e.$$ACTION_1),d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473:()=>Promise.resolve().then(a.bind(a,6001)).then(e=>e.$$ACTION_0),d33ae3afc17ff86a896b65bbc01c77b3fd04f032:()=>Promise.resolve().then(a.bind(a,6001)).then(e=>e.removeItemFromCart),fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c:()=>Promise.resolve().then(a.bind(a,6001)).then(e=>e.getMyCart),"37248d5a5d92203bea071298526bbf56bd6a282e":()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.updateProfile),"4896ea1b4f1dace1ade49eb3651161dc0c4f102a":()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.getUserById),"6f62a9caef1528e29ef4461e98a41e80f8b1eae5":()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.SignOut),"7ef6945e100c99ebbac8da6a81410b4410597f01":()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.updateUserAddress),"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4":()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.$$ACTION_0),abc73778e07b95e9d8f15868fea7f03dbbca9e71:()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.updateUserPaymentMethod),be840f0dc3afac8b8d0c6b02dc3328bacb294db1:()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.signUp),c90075d8792b89f7584984a67b421aab69e556af:()=>Promise.resolve().then(a.bind(a,23829)).then(e=>e.signInWithCredentials)};async function s(e,...r){return(await t[e]()).apply(null,r)}e.exports={"41fc677b184effcb0016e001cd930a9fb30ddb0a":s.bind(null,"41fc677b184effcb0016e001cd930a9fb30ddb0a"),"9ca5872de79006ed19093a5fb9a9561bb840e13b":s.bind(null,"9ca5872de79006ed19093a5fb9a9561bb840e13b"),d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473:s.bind(null,"d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473"),d33ae3afc17ff86a896b65bbc01c77b3fd04f032:s.bind(null,"d33ae3afc17ff86a896b65bbc01c77b3fd04f032"),fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c:s.bind(null,"fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c"),"37248d5a5d92203bea071298526bbf56bd6a282e":s.bind(null,"37248d5a5d92203bea071298526bbf56bd6a282e"),"4896ea1b4f1dace1ade49eb3651161dc0c4f102a":s.bind(null,"4896ea1b4f1dace1ade49eb3651161dc0c4f102a"),"6f62a9caef1528e29ef4461e98a41e80f8b1eae5":s.bind(null,"6f62a9caef1528e29ef4461e98a41e80f8b1eae5"),"7ef6945e100c99ebbac8da6a81410b4410597f01":s.bind(null,"7ef6945e100c99ebbac8da6a81410b4410597f01"),"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4":s.bind(null,"9894e6c57f99a2f4eccac4a43c9c453c2e8680a4"),abc73778e07b95e9d8f15868fea7f03dbbca9e71:s.bind(null,"abc73778e07b95e9d8f15868fea7f03dbbca9e71"),be840f0dc3afac8b8d0c6b02dc3328bacb294db1:s.bind(null,"be840f0dc3afac8b8d0c6b02dc3328bacb294db1"),c90075d8792b89f7584984a67b421aab69e556af:s.bind(null,"c90075d8792b89f7584984a67b421aab69e556af")}},6906:(e,r,a)=>{let t={"413193ecb56048609af8628b5e95dee0ff5a93cf":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.updateOrderToPaid),"52c4508c960f2657f71a1fde5a781c8b1e116f52":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.approvePayPalOrder),"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.getOrderById),"62915f7c5455fffd80487d2ea4fe069934717803":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.$$ACTION_0),"8428591957a96fc1d06bdf1ae8a31cca2aed9436":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.$$ACTION_1),"8b7a29abd0e74ef74c46c98c97840b6db3b5145f":()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.getMyOrders),d20716accc4a0d8fc583e0f1745f62f4af5f6691:()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.createPayPalOrder),ea248243752e282f1c9161e3241b42d6adba1007:()=>Promise.resolve().then(a.bind(a,19680)).then(e=>e.createOrder)};async function s(e,...r){return(await t[e]()).apply(null,r)}e.exports={"413193ecb56048609af8628b5e95dee0ff5a93cf":s.bind(null,"413193ecb56048609af8628b5e95dee0ff5a93cf"),"52c4508c960f2657f71a1fde5a781c8b1e116f52":s.bind(null,"52c4508c960f2657f71a1fde5a781c8b1e116f52"),"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c":s.bind(null,"5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c"),"62915f7c5455fffd80487d2ea4fe069934717803":s.bind(null,"62915f7c5455fffd80487d2ea4fe069934717803"),"8428591957a96fc1d06bdf1ae8a31cca2aed9436":s.bind(null,"8428591957a96fc1d06bdf1ae8a31cca2aed9436"),"8b7a29abd0e74ef74c46c98c97840b6db3b5145f":s.bind(null,"8b7a29abd0e74ef74c46c98c97840b6db3b5145f"),d20716accc4a0d8fc583e0f1745f62f4af5f6691:s.bind(null,"d20716accc4a0d8fc583e0f1745f62f4af5f6691"),ea248243752e282f1c9161e3241b42d6adba1007:s.bind(null,"ea248243752e282f1c9161e3241b42d6adba1007")}},67610:(e,r,a)=>{Promise.resolve().then(a.bind(a,88232)),Promise.resolve().then(a.t.bind(a,15889,23)),Promise.resolve().then(a.t.bind(a,34080,23))},88232:(e,r,a)=>{"use strict";a.d(r,{default:()=>o});var t=a(97247),s=a(3387);let d=(0,a(26323).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var c=a(46817),i=a(58053),n=a(31886);function o(){let[e,r]=(0,c.useFormState)(n.LV,{success:!1,message:""});return(0,t.jsxs)("form",{action:r,className:"w-full",children:[t.jsx(()=>{let{pending:e}=(0,c.useFormStatus)();return(0,t.jsxs)(i.z,{disabled:e,className:"w-full",children:[e?t.jsx(s.Z,{className:"w-4 h-4 animate-spin"}):t.jsx(d,{className:"w-4 h-4"})," ","Place Order"]})},{}),!e.success&&t.jsx("p",{className:"text-destructive py-4",children:e.message})]})}},31886:(e,r,a)=>{"use strict";a.d(r,{LV:()=>s,Yx:()=>c,ZM:()=>d}),a(70689);var t=a(11294);(0,t.$)("413193ecb56048609af8628b5e95dee0ff5a93cf"),(0,t.$)("5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c"),(0,t.$)("8b7a29abd0e74ef74c46c98c97840b6db3b5145f");var s=(0,t.$)("ea248243752e282f1c9161e3241b42d6adba1007"),d=(0,t.$)("d20716accc4a0d8fc583e0f1745f62f4af5f6691"),c=(0,t.$)("52c4508c960f2657f71a1fde5a781c8b1e116f52")},34347:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>j,metadata:()=>w});var t=a(72051),s=a(59624),d=a(92349),c=a(41288),i=a(26269),n=a.n(i),o=a(1779),l=a(37170);let f=({current:e=0})=>t.jsx("div",{className:"flex-between  flex-col md:flex-row  space-x-2 space-y-2",children:["User Login","Shipping Address","Payment Method","Place Order"].map((r,a)=>(0,t.jsxs)(n().Fragment,{children:[t.jsx("div",{className:(0,l.cn)("p-2 w-56 rounded-full text-center  text-sm",a===e?"bg-secondary":""),children:r}),"Place Order"!==r&&t.jsx("hr",{className:"w-16 border-t border-gray-300 mx-2"})]},r))});var u=a(98300),b=a(6669),p=a(52621),h=a(6001),m=a(23829),x=a(89112);let y=(0,a(45347).createProxy)(String.raw`/Users/obadosunmu/Documents/newcommerce/chooselifeandpeace/app/(root)/place-order/place-order-form.tsx#default`),w={title:`Place Order - ${x.iC}`};async function j(){let e=await (0,h.getMyCart)(),r=await (0,o.I8)(),a=await (0,m.getUserById)(r?.user.id);return e&&0!==e.items.length||(0,c.redirect)("/cart"),a.address||(0,c.redirect)("/shipping-address"),a.paymentMethod||(0,c.redirect)("/payment-method"),(0,t.jsxs)(t.Fragment,{children:[t.jsx(f,{current:3}),t.jsx("h1",{className:"py-4 text-2xl",children:"Place Order"}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 md:gap-5",children:[(0,t.jsxs)("div",{className:"overflow-x-auto md:col-span-2 space-y-4",children:[t.jsx(b.Zb,{children:(0,t.jsxs)(b.aY,{className:"p-4 gap-4",children:[t.jsx("h2",{className:"text-xl pb-4",children:"Shipping Address"}),t.jsx("p",{children:a.address.fullName}),(0,t.jsxs)("p",{children:[a.address.streetAddress,", ",a.address.city,","," ",a.address.postalCode,", ",a.address.country," "]}),t.jsx("div",{children:t.jsx(d.default,{href:"/shipping-address",children:t.jsx(u.z,{variant:"outline",children:"Edit"})})})]})}),t.jsx(b.Zb,{children:(0,t.jsxs)(b.aY,{className:"p-4 gap-4",children:[t.jsx("h2",{className:"text-xl pb-4",children:"Payment Method"}),t.jsx("p",{children:a.paymentMethod}),t.jsx("div",{children:t.jsx(d.default,{href:"/payment-method",children:t.jsx(u.z,{variant:"outline",children:"Edit"})})})]})}),t.jsx(b.Zb,{children:(0,t.jsxs)(b.aY,{className:"p-4 gap-4",children:[t.jsx("h2",{className:"text-xl pb-4",children:"Order Items"}),(0,t.jsxs)(p.iA,{children:[t.jsx(p.xD,{children:(0,t.jsxs)(p.SC,{children:[t.jsx(p.ss,{children:"Item"}),t.jsx(p.ss,{children:"Quantity"}),t.jsx(p.ss,{children:"Price"})]})}),t.jsx(p.RM,{children:e.items.map(e=>(0,t.jsxs)(p.SC,{children:[t.jsx(p.pj,{children:(0,t.jsxs)(d.default,{href:`/product/${e.slug}`,className:"flex items-center",children:[t.jsx(s.default,{src:e.image,alt:e.name,width:50,height:50}),t.jsx("span",{className:"px-2",children:e.name})]})}),t.jsx(p.pj,{children:t.jsx("span",{className:"px-2",children:e.qty})}),(0,t.jsxs)(p.pj,{className:"text-right",children:["$",e.price]})]},e.slug))})]}),t.jsx(d.default,{href:"/cart",children:t.jsx(u.z,{variant:"outline",children:"Edit"})})]})})]}),t.jsx("div",{children:t.jsx(b.Zb,{children:(0,t.jsxs)(b.aY,{className:"p-4 gap-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("div",{children:"Items"}),t.jsx("div",{children:(0,l.xG)(e.itemsPrice)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("div",{children:"Tax"}),t.jsx("div",{children:(0,l.xG)(e.taxPrice)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("div",{children:"Shipping"}),t.jsx("div",{children:(0,l.xG)(e.shippingPrice)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[t.jsx("div",{children:"Total"}),t.jsx("div",{children:(0,l.xG)(e.totalPrice)})]}),t.jsx(y,{})]})})})]})]})}},52621:(e,r,a)=>{"use strict";a.d(r,{RM:()=>n,SC:()=>o,iA:()=>c,pj:()=>f,ss:()=>l,xD:()=>i});var t=a(72051),s=a(26269),d=a(37170);let c=s.forwardRef(({className:e,...r},a)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:a,className:(0,d.cn)("w-full caption-bottom text-sm",e),...r})}));c.displayName="Table";let i=s.forwardRef(({className:e,...r},a)=>t.jsx("thead",{ref:a,className:(0,d.cn)("[&_tr]:border-b",e),...r}));i.displayName="TableHeader";let n=s.forwardRef(({className:e,...r},a)=>t.jsx("tbody",{ref:a,className:(0,d.cn)("[&_tr:last-child]:border-0",e),...r}));n.displayName="TableBody",s.forwardRef(({className:e,...r},a)=>t.jsx("tfoot",{ref:a,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let o=s.forwardRef(({className:e,...r},a)=>t.jsx("tr",{ref:a,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));o.displayName="TableRow";let l=s.forwardRef(({className:e,...r},a)=>t.jsx("th",{ref:a,className:(0,d.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r}));l.displayName="TableHead";let f=s.forwardRef(({className:e,...r},a)=>t.jsx("td",{ref:a,className:(0,d.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r}));f.displayName="TableCell",s.forwardRef(({className:e,...r},a)=>t.jsx("caption",{ref:a,className:(0,d.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption"},19680:(e,r,a)=>{"use strict";a.r(r),a.d(r,{$$ACTION_0:()=>Z,$$ACTION_1:()=>M,approvePayPalOrder:()=>T,createOrder:()=>E,createPayPalOrder:()=>A,getMyOrders:()=>_,getOrderById:()=>C,updateOrderToPaid:()=>k});var t=a(28713);a(9640);var s=a(6352),d=a(79306),c=a(39558),i=a(54068),n=a(53020),o=a(62276),l=a(70592),f=a(80166),u=a(83557);async function b(){let e=n.cookies().get("sessionCartId")?.value;if(!e)return;let r=await (0,s.I8)(),a=r?.user.id;return await d.Z.query.carts.findFirst({where:a?(0,i.eq)(c.carts.userId,a):(0,i.eq)(c.carts.sessionCartId,e)})}let p=e=>{let r=(0,l.Xp)(e.reduce((e,r)=>e+r.price*r.qty,0)),a=(0,l.Xp)(r>100?0:10),t=(0,l.Xp)(.15*r),s=(0,l.Xp)(r+a+t);return{itemsPrice:r.toFixed(2),shippingPrice:a.toFixed(2),taxPrice:t.toFixed(2),totalPrice:s.toFixed(2)}},h=(0,t.j)("d2d3db1dd1f5ae5ad5053f8ad3bc0f2da4d94473",m);async function m(e){try{let r=n.cookies().get("sessionCartId")?.value;if(!r)throw Error("Cart Session not found");let a=await (0,s.I8)(),t=a?.user.id,l=await b(),u=o.oU.parse(e),h=await d.Z.query.products.findFirst({where:(0,i.eq)(c.products.id,u.productId)});if(!h)throw Error("Product not found");if(l){let e=l.items.find(e=>e.productId===u.productId);if(e){if(h.stock<e.qty+1)throw Error("Not enough stock");l.items.find(e=>e.productId===u.productId).qty=e.qty+1}else{if(h.stock<1)throw Error("Not enough stock");l.items.push(u)}return await d.Z.update(c.carts).set({items:l.items,...p(l.items)}).where((0,i.xD)((0,i.eq)(c.carts.id,l.id))),(0,f.revalidatePath)(`/product/${h.slug}`),{success:!0,message:`${h.name} ${e?"updated in":"added to"} cart successfully`}}if(h.stock<1)throw Error("Not enough stock");return await d.Z.insert(c.carts).values({userId:t,items:[u],sessionCartId:r,...p([u])}),(0,f.revalidatePath)(`/product/${h.slug}`),{success:!0,message:"Item added to cart successfully"}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}let x=(0,t.j)("9ca5872de79006ed19093a5fb9a9561bb840e13b",y);async function y(e){try{if(!n.cookies().get("sessionCartId")?.value)throw Error("Cart Session not found");let r=await d.Z.query.products.findFirst({where:(0,i.eq)(c.products.id,e)});if(!r)throw Error("Product not found");let a=await b();if(!a)throw Error("Cart not found");let t=a.items.find(r=>r.productId===e);if(!t)throw Error("Item not found");return 1===t.qty?a.items=a.items.filter(e=>e.productId!==t.productId):a.items.find(r=>r.productId===e).qty=t.qty-1,await d.Z.update(c.carts).set({items:a.items,...p(a.items)}).where((0,i.eq)(c.carts.id,a.id)),(0,f.revalidatePath)(`/product/${r.slug}`),{success:!0,message:`${r.name}  ${a.items.find(r=>r.productId===e)?"updated in":"removed from"} cart successfully`}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}(0,u.h)([b,h,x]),(0,t.j)("fe554d431ad4dbdcf2b2dc0e821c8d0adcf5a00c",b),(0,t.j)("41fc677b184effcb0016e001cd930a9fb30ddb0a",h),(0,t.j)("d33ae3afc17ff86a896b65bbc01c77b3fd04f032",x);var w=a(48185),j=a(19188),P=a(47502),v=a(87729),g=a(22614);let N=process.env.PAYPAL_API_URL||"https://api-m.sandbox.paypal.com",q={createOrder:async function(e){let r=await I(),a=`${N}/v2/checkout/orders`;return $(await fetch(a,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:e}}]})}))},capturePayment:async function(e){let r=await I(),a=`${N}/v2/checkout/orders/${e}/capture`;return $(await fetch(a,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}))}};async function I(){let{PAYPAL_CLIENT_ID:e,PAYPAL_APP_SECRET:r}=process.env,a=Buffer.from(e+":"+r).toString("base64"),t=await fetch(`${N}/v1/oauth2/token`,{method:"post",body:"grant_type=client_credentials",headers:{Authorization:`Basic ${a}`}});return(await $(t)).access_token}async function $(e){if(200===e.status||201===e.status)return e.json();throw Error(await e.text())}var O=a(6335);async function C(e){return await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e),with:{orderItems:!0,user:{columns:{name:!0,email:!0}}}})}async function _({limit:e=O.IV,page:r}){let a=await (0,s.I8)();if(!a)throw Error("User is not authenticated");return{data:await d.Z.query.orders.findMany({where:(0,i.eq)(c.orders.userId,a.user.id),orderBy:[(0,P.C)(c.products.createdAt)],limit:e,offset:(r-1)*e}),totalPages:Math.ceil((await d.Z.select({count:(0,v.i6)`count(${v.i6.raw("*")})`.mapWith(Number)}).from(c.orders).where((0,i.eq)(c.orders.userId,a.user.id)))[0].count/e)}}let E=(0,t.j)("62915f7c5455fffd80487d2ea4fe069934717803",Z);async function Z(){try{let e=await (0,s.I8)();if(!e)throw Error("User is not authenticated");let r=await b(),a=await (0,w.getUserById)(e?.user.id);r&&0!==r.items.length||(0,j.redirect)("/cart"),a.address||(0,j.redirect)("/shipping-address"),a.paymentMethod||(0,j.redirect)("/payment-method");let t=o.Mn.parse({userId:a.id,shippingAddress:a.address,paymentMethod:a.paymentMethod,itemsPrice:r.itemsPrice,shippingPrice:r.shippingPrice,taxPrice:r.taxPrice,totalPrice:r.totalPrice}),n=await d.Z.transaction(async e=>{let a=await e.insert(c.orders).values(t).returning();for(let t of r.items)await e.insert(c.orderItems).values({...t,price:t.price.toFixed(2),orderId:a[0].id});return await d.Z.update(c.carts).set({items:[],totalPrice:"0",shippingPrice:"0",taxPrice:"0",itemsPrice:"0"}).where((0,i.eq)(c.carts.id,r.id)),a[0].id});if(!n)throw Error("Order not created");(0,j.redirect)(`/order/${n}`)}catch(e){if((0,g.isRedirectError)(e))throw e;return{success:!1,message:(0,l.Z)(e)}}}async function A(e){try{let r=await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e)});if(r){let a=await q.createOrder(Number(r.totalPrice));return await d.Z.update(c.orders).set({paymentResult:{id:a.id,email_address:"",status:"",pricePaid:"0"}}).where((0,i.eq)(c.orders.id,e)),{success:!0,message:"PayPal order created successfully",data:a.id}}throw Error("Order not found")}catch(e){return{success:!1,message:(0,l.Z)(e)}}}async function T(e,r){try{let a=await d.Z.query.orders.findFirst({where:(0,i.eq)(c.orders.id,e)});if(!a)throw Error("Order not found");let t=await q.capturePayment(r.orderID);if(!t||t.id!==a.paymentResult?.id||"COMPLETED"!==t.status)throw Error("Error in paypal payment");return await k({orderId:e,paymentResult:{id:t.id,status:t.status,email_address:t.payer.email_address,pricePaid:t.purchase_units[0]?.payments?.captures[0]?.amount?.value}}),(0,f.revalidatePath)(`/order/${e}`),{success:!0,message:"Your order has been successfully paid by PayPal"}}catch(e){return{success:!1,message:(0,l.Z)(e)}}}let k=(0,t.j)("8428591957a96fc1d06bdf1ae8a31cca2aed9436",M);async function M({orderId:e,paymentResult:r}){let a=await d.Z.query.orders.findFirst({columns:{isPaid:!0},where:(0,i.eq)(c.orders.id,e),with:{orderItems:!0}});if(!a)throw Error("Order not found");if(a.isPaid)throw Error("Order is already paid");await d.Z.transaction(async t=>{for(let e of a.orderItems)await t.update(c.products).set({stock:(0,v.i6)`${c.products.stock} - ${e.qty}`}).where((0,i.eq)(c.products.id,e.productId));await t.update(c.orders).set({isPaid:!0,paidAt:new Date,paymentResult:r}).where((0,i.eq)(c.orders.id,e))})}(0,u.h)([C,_,E,A,T,k]),(0,t.j)("5a6d56e69c6fdbdbb96f5fcdf3cb938533d1c24c",C),(0,t.j)("8b7a29abd0e74ef74c46c98c97840b6db3b5145f",_),(0,t.j)("ea248243752e282f1c9161e3241b42d6adba1007",E),(0,t.j)("d20716accc4a0d8fc583e0f1745f62f4af5f6691",A),(0,t.j)("52c4508c960f2657f71a1fde5a781c8b1e116f52",T),(0,t.j)("413193ecb56048609af8628b5e95dee0ff5a93cf",k)}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[329,390,414,27,242,453,789,994,613,249],()=>a(90193));module.exports=t})();